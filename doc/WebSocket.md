### 프로토콜

메시지를 주고받는 형식(통신 규약)

### HTTP

- 무상태/비연결성 프로토콜
- 클라이언트가 요청해야 서버가 응답을 줌. (단방향)

### WebSocket

- 클라이언트와 서버가 양방향(실시간) 통신을함
- 클라이언트와 서버의 첫 연결 시에만 HTTP 통신 이후 통신은 WebSocket 통신
- http:// 대신 ws://의 url을 가진 프로토콜 사용
- stomp는 명시적으로 ws://를 사용하진 않지만 내부적으로 ws://를 사용.

### HTTP 와 WebSocket 모두 TCP 위에서 작동한다.

- TCP는 양방향 프로토콜이다.
- Http는 양방향 연결을 맺고 끊은다음 통신 (핸드셰이크)
- WebSocket은 양방향 연결을 맺고 유지하며 통신
    - WebSocket도 최초 연결시엔 HTTP 를 사용함.

### Polling vs WebSocket

- Polling
    - 폴링은 클라이언트가 주기적으로 서버에 요청을 보내 상태를 업데이트함.
    - 지속적인 서버 요청으로 서버 과부하 가능성있음.
    - 간결하게 구현 가능
- WebSocket
    - 클라이언트 와 서버 연결유지
    - 서버가 클라이언트로 메시지를 바로 전달.

### SSE

- SSE
    - 서버에서 클라이언트로 메시지를 보내는 프로토콜 (단방향)
    - HTTP 기반의 프로토콜
    - HTTP 메시지를 보내기 때문에 웹소켓보다 무겁다 성능이 안좋다.
    - 사용자 알림 기능에 많이 사용된다.
- WebSocket과 다르게 단방향 통신이다.
- WebSocket과 다르게 메시지 전송 시 HTTP 프로토콜을 사용한다.

### Stomp

- WebSocket의 발전된 형태 → WebSocket 기반의 동작
- 목적지 기반 메시지 라우팅.
    - 클라이언트와 서버가 특정 topic(room)을 기준으로 메시지를 교환하는 구조

### Stomp 메시지 교환 절차

1. 클라이언트에서 특정 topic 에 메시지 발행
2. brocker에 의해 해당 topic 에 메시지 전달
3. 동시에 해당 topic을 구독하는 클라이언트에 실시간으로 메시지 전달.

### Redis pub/sub을 통해 멀티서버 환경 고려(kafka를 사용하기도함)

- Redis를 구독(sub)하는 모든 서버를 대상으로 메시지를 발행한다(pub)
    - a, b, c 서버가 redis를 구독한다.(sub)
    - 클라이언트A가 임의의 서버로 요청을 보낸다.
    - 서버는 Redis로 메시지를 전달한다.
    - Redis는 모든 서버에게 메시지를 전달한다.(pub)
    - 클라이언트B와 연결된 서버가 Redis에게 받은 메시지를 수신한다.